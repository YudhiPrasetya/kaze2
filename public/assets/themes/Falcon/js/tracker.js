(self.webpackChunk=self.webpackChunk||[]).push([[151],{863:(e,t,o)=>{"use strict";var n=o(6486),r=o.n(n),i=o(9755);function a(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function s(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?a(Object(o),!0).forEach((function(t){c(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function c(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var u=function(e,t,o){var n=new XMLHttpRequest;n.withCredentials=!0,n.open(e,t,!0),n.onreadystatechange=function(){4==n.readyState&&o(JSON.parse(n.responseText))},"POST"==e&&n.setRequestHeader("Content-type","application/json"),n.send()};i((function(){if(i("#map").length){var e=function e(i){var s=r().findIndex(t.devices,(function(e){return e.uniqueId==c}));if(s>=0){var u=t.devices[s];if(0==u.positions.length)a&&(a=!1);else{var p=u.positions.slice(-1)[0],d=[p.longitude,p.latitude];o||n||l.flyTo({center:d,zoom:16,essential:!0,speed:3,curve:1}),f.features[0].geometry.coordinates=[],r().each(u.positions,(function(e){f.features[0].geometry.coordinates.push([e.longitude,e.latitude])}));for(var m=turf.length(f.features[0]),y=0;y<m;y+=m/500){var v=turf.along(f.features[0],y);f.features[0].geometry.coordinates.push(v.geometry.coordinates)}if(f.features[0].geometry.coordinates.length>0){var h=f.features[0].geometry.coordinates.slice(-2);if(g.features[0].geometry.coordinates=f.features[0].geometry.coordinates.slice(-1)[0],h.length>0){var b=h[0],w=1===h.length?b:h[1];(b||w)&&(g.features[0].properties.bearing=turf.bearing(turf.point(b),turf.point(w)))}}l.getSource("point").setData(g)}}requestAnimationFrame(e)},t={devices:[]},o=!1,n=!1,a=!0,c=null;i("a.list-group-item-action.tracker-item").click((function(e){e.preventDefault(),i("a.list-group-item-action.tracker-item").removeClass("active"),i(this).addClass("active"),c=i(this).data("imei"),f.features[0].geometry.coordinates=[],o=!1,n=!1,a=!0;var s=r().findIndex(t.devices,(function(e){return e.uniqueId==c}));return console.log(s),s<0&&_toast("Not found.","Device not registered","danger").show(),!1})),mapboxgl.accessToken="pk.eyJ1IjoicmFtZGhhbmkxOSIsImEiOiJjaWd2M2IyMHowZ29odzdtNWZmMjVrajZ1In0.ivJTANe4hb5MKPOo_Z0cdg";var l=new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",zoom:3,antialias:!0});l.addControl(new mapboxgl.NavigationControl),l.addControl(new mapboxgl.AttributionControl({compact:!0})),l.addControl(new mapboxgl.FullscreenControl);var p=new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0});l.addControl(p);var d=new mapboxgl.ScaleControl({maxWidth:80,unit:"imperial"});l.addControl(d),d.setUnit("metric");var f={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:[]}}]},g={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Point",coordinates:[]}}]},m=function(){o=!0},y=function(){n=!0};l.on("drag",m),l.on("dragend",m),l.on("dragstart",m),l.on("touchmove",m),l.on("mousedown",y),l.on("touchstart",y),l.on("wheel",(function(){m(),y()})),l.on("rotate",(function(){m(),y()})),l.on("pitch",(function(){m(),y()})),l.on("zoom",(function(){m(),y()})),l.on("load",(function(){l.loadImage("/assets/themes/Falcon/images/marker.png",(function(t,o){if(t)throw t;l.addImage("yellow-car",o),l.addSource("point",{type:"geojson",data:g}),l.addLayer({id:"point",source:"point",type:"symbol",layout:{"icon-image":"yellow-car","icon-size":.07,"icon-rotate":["get","bearing"],"icon-rotation-alignment":"map","icon-allow-overlap":!0,"icon-ignore-placement":!0}}),e()}))})),setInterval((function(){u("GET","http://35.188.167.11:8082/api/session?token=zRdL58j3niWrvQGbWolVuo3gyLl2oSAK",(function(e){u("GET","http://35.188.167.11:8082/api/devices",(function(e){t.devices=r().map(e,(function(e){return s(s({},e),{},{positions:[]})})),r().each(t.devices,(function(e){"online"===e.status?i("small#tracker-"+e.uniqueId).css("background-color","#00D27A"):i("small#tracker-"+e.uniqueId).css("background-color","#E63757")})),u("GET","http://35.188.167.11:8082/api/positions",(function(e){r().each(e,(function(e){var o=r().findIndex(t.devices,(function(t){return t.id===e.deviceId}));t.devices[o].positions.push(e)}))}))}))}))}),3e3)}}))}},e=>{"use strict";e.O(void 0,[974],(()=>{return t=863,e(e.s=t);var t}))}]);